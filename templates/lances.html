{% extends "base.html" %}

{% block content %}

<h1 class="page-title">Lances - {{ data }}</h1>

<a href="{{ url_for('quadra', nome=quadra) }}" class="btn-back">
    ← Voltar para Datas
</a>

<div class="video-grid">

    {% for hora, drive_id, status in lances %}
        <div class="video-card">
           <div class="video-wrapper" onclick="carregarVideo(this, '{{ drive_id }}')">
                <img
                   src="https://drive.google.com/thumbnail?id={{ drive_id }}"
                   class="video-thumb">
           
               <div class="play-overlay">▶</div>
            </div>

            <div class="video-info">
                <div class="video-header">
                    <span class="hora-badge">{{ hora }}</span>

                    {% if status == 'PAGO' %}
                        <span class="status-paid">PAGO</span>
                    {% else %}
                        <span class="status-pending">DISPONÍVEL</span>
                    {% endif %}
                </div>

                  {% if status == 'PAGO' %}
                      <a href="/download/{{ drive_id }}" class="download-button">
                          Baixar Vídeo
                      </a>
                  
                  {% elif status == 'CONSUMIDO' %}
                      <span class="status-used">Download já realizado</span>
                  
                  {% else %}
                      <form method="POST"
                            action="/comprar/{{ drive_id }}?quadra={{ quadra }}&data={{ data }}">
                          <button class="buy-button">
                              Comprar Replay - R$ 2,59
                          </button>
                      </form>
                  {% endif %}

            </div>

        </div>
    {% endfor %}

</div>

<script>
function carregarVideo(element, driveId) {

    element.innerHTML = `
        <div class="video-loading">Carregando...</div>
        <iframe
            src="https://drive.google.com/file/d/${driveId}/preview"
            allow="autoplay">
        </iframe>
    `;
}
</script>

{% endblock %}